import * as path from 'node:path';
import { defineConfig } from 'orval';

const infiniteOperationNames = [
  'FindMuscleGroups',
  'FindTrainings',
  'FindTrainingsForCalendar',
  'FindPerformanceStats',
];

export default defineConfig({
  'befit-mobile': {
    input: {
      target: './api/swagger.json',
      validation: false,
    },
    output: {
      mode: 'tags',
      target: './state/endpoints/api.ts', // where file is going to be generated
      client: 'react-query',
      tslint: true,
      clean: true,
      override: {
        header: (info: any): string[] => [
          'Generated by orval üçÉ',
          'Do not edit manually.',
          ...(info.title ? [info.title] : []),
          ...(info.description ? [info.description] : []),
          ...(info.version ? [`OpenAPI spec version: ${info.version}`] : []),
          '/* eslint-disable */',
          '// @ts-nocheck',
        ],
        enumGenerationType: 'enum',
        useTypeOverInterfaces: true,
        useDates: true,
        query: {
          useQuery: true,
          useSuspenseQuery: true,
          usePrefetch: false,
        },
        operations: infiniteOperationNames.reduce((acc: Record<string, any>, operation) => {
          acc[operation] = {
            query: {
              useQuery: true,
              useSuspenseQuery: true,
              useInfinite: true,
              useSuspenseInfiniteQuery: false,
              useInfiniteQueryParam: 'page', // or 'offset', 'cursor' depending on your API
            },
          };
          return acc;
        }, {}),
        mutator: {
          path: '../../api/api-client.ts', // custom axios/fetch instance
          name: 'customInstance',
          alias: {
            '@/api/query-client': path.resolve(__dirname, './api/query-client'),
          },
        },
        contentType: {
          include: [
            'multipart/form-data',
            'application/json',
            'application/xml',
            'text/plain',
            'text/json',
          ],
        },
      },
    },
    hooks: {
      afterAllFilesWrite: 'prettier --write ./state/endpoints/**/*.ts',
    },
  },
});